{\rtf1\ansi\ansicpg1252\cocoartf2761
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue;\f1\fnil\fcharset0 HelveticaNeue-Italic;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab560
\pard\pardeftab560\slleading20\partightenfactor0

\f0\fs26 \cf0 // #popclip extension for Google Gemini\
// name: Google Gemini Grammar Check\
// icon: 
\f1\i iconify:
\f0\i0 fa-solid:spell-check\
// language: javascript\
// module: true\
// entitlements: [network]\
// options: [\{\
//   identifier: apikey,\
//   label: API Key,\
//   type: string,\
//   description: 'Obtain API key from Google Cloud Console'\
// \}]\
\
const axios = require("axios");\
\
async function checkGrammar(input, options) \{\
  const prompt = `Please correct the grammar and polish the following text, without providing any translation, comments, or notes, and use the same language as the input:\
\
$\{input.text\}`;\
\
  const requestBody = \{\
    "contents": [\{ "parts": [\{"text": prompt\}] \}],\
    "safetySettings": [\
      \{ "category": "HARM_CATEGORY_HARASSMENT", "threshold": "BLOCK_ONLY_HIGH" \}\
    ],\
    "generationConfig": \{\
      "stopSequences": [],\
      "temperature": 1.0,\
      "maxOutputTokens": 800,\
      "topP": 0.8,\
      "topK": 10\
    \}\
  \};\
\
  try \{\
    const response = await axios.post(\
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=$\{options.apikey\}`,\
      requestBody,\
      \{ headers: \{ 'Content-Type': 'application/json' \} \}\
    );\
\
    const generatedText = response.data.candidates[0].content.parts.map(part => part.text).join('');\
    popclip.pasteText(generatedText);\
  \} catch (error) \{\
    console.error("Error checking grammar:", error);\
    popclip.showError("Error checking grammar: " + error.message);\
  \}\
\
  return null;\
\}\
\
exports.actions = [\{\
  title: "Grammar Check with Google Gemini",\
  after: "paste-result",\
  code: checkGrammar,\
\}];}